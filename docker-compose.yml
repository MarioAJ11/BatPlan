# Docker Compose - Define servicios del proyecto
# Para levantar: docker-compose up -d
# Para detener: docker-compose down

version: '3.8'

services:
  # PostgreSQL - Base de datos principal
  postgres:
    image: postgres:15-alpine  # Imagen oficial de PostgreSQL (ligera)
    container_name: batplan-postgres
    restart: unless-stopped  # Reinicia automáticamente si se cae

    ports:
      - '5432:5432'  # Puerto local:Puerto contenedor

    environment:
      # Credenciales de la base de datos
      POSTGRES_USER: batplan_user
      POSTGRES_PASSWORD: batplan_dev_password_2024
      POSTGRES_DB: batplan_db

    volumes:
      # Persiste datos en tu máquina (no se pierden al reiniciar)
      - postgres_data:/var/lib/postgresql/data

    healthcheck:
      # Verifica que PostgreSQL esté listo
      test: ['CMD-SHELL', 'pg_isready -U batplan_user -d batplan_db']
      interval: 10s
      timeout: 5s
      retries: 5

  # pgAdmin - Interfaz gráfica para PostgreSQL (opcional)
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: batplan-pgadmin
    restart: unless-stopped

    ports:
      - '5050:80'  # Accede en http://localhost:5050

    environment:
      PGADMIN_DEFAULT_EMAIL: admin@batplan.local
      PGADMIN_DEFAULT_PASSWORD: admin123

    depends_on:
      - postgres

# Volúmenes para persistir datos
volumes:
  postgres_data:
    driver: local
